Role:
You are a senior backend engineer working on an existing production‚Äëready MERN + Drizzle + PostgreSQL application.

IMPORTANT CONSTRAINTS

This is a LIVE, WORKING application

DO NOT redesign schemas

DO NOT change existing calculations

DO NOT modify dashboards or frontend

DO NOT introduce breaking changes

Backend correctness + future GST safety ONLY

üéØ GOAL
Safely support GST in Buy & Sell Bills for future use (GST reports, invoices, accountant exports) while keeping:

Inventory valuation GST‚Äëneutral

Profit calculations GST‚Äëneutral

Revenue calculations GST‚Äëneutral

All existing dashboards unchanged

GST must be stored, optional, and isolated.

1Ô∏è‚É£ SCHEMA VERIFICATION (NO CHANGES UNLESS MISSING)
Confirm these fields exist and remain OPTIONAL / NULLABLE:

buy_bills
dealer_gst_number (text, nullable)

gst_percentage (numeric, nullable)

gst_amount (numeric, nullable)

sell_bills
customer_gst_number (text, nullable)

gst_percentage (numeric, nullable)

gst_amount (numeric, nullable)

‚ùó DO NOT make GST mandatory
‚ùó DO NOT add constraints
‚ùó DO NOT add defaults that change old data

2Ô∏è‚É£ FIX createBuyBill ‚Äî STORE GST ONLY
Rules
GST applies on purchase value

GST is stored separately

GST must NOT affect:

totalAmount

averageBuyPrice

inventory value

profit

REQUIRED LOGIC (verify / fix if needed)
const totalAmount = req.items.reduce(
  (sum, item) => sum + item.buyPrice * item.quantity,
  0
);

const gstAmount =
  req.gstPercentage != null
    ? (totalAmount * req.gstPercentage) / 100
    : null;

await tx.insert(buyBills).values({
  dealerName: req.dealerName ?? null,
  dealerGSTNumber: req.dealerGSTNumber ?? null,
  gstPercentage: req.gstPercentage ?? null,
  gstAmount: gstAmount ? gstAmount.toFixed(2) : null,
  billDate: req.billDate,
  totalAmount: totalAmount.toFixed(2),
});
‚úÖ Inventory remains clean
‚úÖ Old data unaffected
‚úÖ GST audit‚Äësafe

3Ô∏è‚É£ FIX createSellBill ‚Äî STORE GST ONLY
Rules
GST applies on selling amount

GST must NOT affect:

profit

stock

revenue

dashboards

REQUIRED LOGIC (verify / fix if needed)
const gstAmount =
  req.gstPercentage != null
    ? (billTotalAmount * req.gstPercentage) / 100
    : 0;

await tx.update(sellBills).set({
  totalProfit: billTotalProfit.toFixed(2),
  totalAmount: billTotalAmount.toFixed(2),
  gstAmount: gstAmount.toFixed(2),
});
‚úÖ Profit stays accurate
‚úÖ GST ready for invoices
‚úÖ No dashboard impact

4Ô∏è‚É£ DASHBOARD & REPORTS ‚Äî DO NOTHING üö´
Explicitly verify that:

GST is NOT included in:

profit

revenue

inventory value

expenses

charts

If GST appears anywhere in dashboard logic ‚Üí REMOVE IT.