Goal:Safely support GST in Buy & Sell Bills for future use (GST reports, P&L, accountant exports) without changing existing calculations or dashboards.

üîß Backend Changes Only (NO breaking UI)

1Ô∏è‚É£ Schema Validation (already done correctly)

Confirm the following fields exist and remain OPTIONAL:

buy_bills

dealer_gst_number (text, nullable)

gst_percentage (numeric, nullable)

gst_amount (numeric, nullable)

sell_bills

customer_gst_number (text, nullable)

gst_percentage (numeric, nullable)

gst_amount (numeric, nullable)

‚ö†Ô∏è Do not enforce GST as required anywhere.

2Ô∏è‚É£ createBuyBill ‚Äî GST Calculation (Store Only)

Ensure GST is:

Calculated only if gstPercentage is provided

Stored separately

NOT added to totalAmount

const totalAmount = req.items.reduce( (sum, item) => sum + item.buyPrice * item.quantity, 0 ); const gstAmount = req.gstPercentage ? (totalAmount * req.gstPercentage) / 100 : null; await tx.insert(buyBills).values({ dealerName: req.dealerName, dealerGSTNumber: req.dealerGSTNumber ?? null, gstPercentage: req.gstPercentage ?? null, gstAmount: gstAmount?.toFixed(2) ?? null, billDate: req.billDate, totalAmount: totalAmount.toFixed(2), });

‚úî Keeps inventory valuation GST‚Äëneutral‚úî Safe for historical data‚úî Accountant‚Äëfriendly

3Ô∏è‚É£ createSellBill ‚Äî GST Calculation (Store Only)

GST:

Applies to sale value

Stored separately

Does NOT affect profit

const gstAmount = req.gstPercentage ? (billTotalAmount * req.gstPercentage) / 100 : 0; await tx.update(sellBills).set({ totalProfit: billTotalProfit.toFixed(2), totalAmount: billTotalAmount.toFixed(2), gstAmount: gstAmount.toFixed(2), });

‚úî Profit remains clean‚úî GST ready for invoices later‚úî No dashboard impact

4Ô∏è‚É£ Dashboard & Reports ‚Äî DO NOTHING (Important)

‚ùå Do NOT include GST in:

Profit

Revenue

Inventory value

Expense reports

Your current queries are correct ‚Äî keep them unchanged.

üß† Design Decisions (Why this is correct)

GST is a liability, not income

Profit = Selling price ‚àí Buy price (GST excluded)

GST can change by law ‚Üí storing separately = future proof

Historical bills stay valid forever

